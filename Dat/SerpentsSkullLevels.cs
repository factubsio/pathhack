namespace Pathhack.Dat;

public static class SerpentsSkullLevels
{
    public static readonly SpecialLevel ShoreBeached = new("ss_shore_beached", """
,,,,,,,,,,,,,,±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±,,,,,
,,,,,,,,,,,,,,,,±±±±±±±±±±±±±±±±±±±±±±±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,1111111111,,±±±±±±±±,,,,,22222222,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,+111111111,,,,,,,±±±222222222222+,,,,,,,,,,,,,,,,,,,,,,
~~~~~~~~~~,,,,,,,,,,,,,,,1111111111,,,,,2+2222222222222222,,,,,,,,,,,,,,,,,,,,,,
~~~~~~~~~~~~,,,,,,,,,,,~~1111111111,,22222222222222222222,,,,,,,,,,,,,,,,,,,,,,,
~~~~~~~~~~~~~~~~~~,,,,~~~1111111111,,2222222222222222222,,,,,,,,,,,,,,,,,,,,,,,,
,,,,~~~~0000000000,,,~~~~1111111111,,,2222222222222222,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,0000000000+00~~~~111111111+,,,,22222222222222,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,0000000000000000~1111111111~~~~~2222222222,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,+000000000000000~111111111~~~~~~~22222222,,,,,,~~~~~~~~,,,,,,,,,,,,,,,,,
,,,,,,,,0000000000000000~111111111~~~~~~~~~2222~~~~~~~~~~~~~~~~~,,,,,,,,,,,,,,,,
,,,,,,,,000000000000000~~~1111111~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,,,,,,,,,,
,,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,,,,,,,
,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,,,,,,,
,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,,,,,,
,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,>,,
,,,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,,
,,<,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,,,
,,,,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
,,,,,,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
""",



        PostRender: b =>
        {
            b.Level.Outdoors = true;
            b.Level.WallColor = ConsoleColor.DarkYellow;
            foreach (var room in b.Level.Rooms)
                room.Flags |= RoomFlags.Lit;
            b.Stair(b['<'], TileType.BranchUp);
            b.Stair(b['>'], TileType.StairsDown);
        })
    {
        HasPortalToParent = true,
        HasStairsDown = true,
        SolidRooms = [0, 1, 2],
    };

    public static readonly SpecialLevel ShoreDebris = new("ss_shore_debris", """
,,,,,,,,,,,±±±±±±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,±±±±,,,,,,,,,,,,,,,,,,,,,
,>,,,,,,,,±±±±±±±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,±±±±±,,,,,,,,,,,±±±±,,,,,
,,,,,,,,,,±±±±±±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,±±±±±,,,,,,,,,,±±±±±±±±±,
±±±±±±±,,,±±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,±±±,,,,,,,±±±,,,,,,,,,±±±±±±±±±±,
±±±±±±±±,,,±±±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,±±±±±±,,,,,,,,,,,,,,,,,,,±±±±±±±±±±,
±±±±±±±±,,,,±±±±±,,,,,,,,,±±±,,,,,,,,,,,,,,,±±±±±±,,,,,,,,,,,,,,,,,,,±±±±±±±±±,,
±±±±±±±±,,,,,,,,,,,,,,,,,,±±±±,,,,,,,,,,,,,,±±±±,,,,,,,,,,,,,,,,,,,,,,,±±±,±±±,,
±±±±±±±±,,,,,,,,,,,,,,,,,±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
±±±±±±±,,,,,,,,,,,,,,,,,,±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
±±±±±±,,,,,,,,,,,,,,,,,,,±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
±±±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
±±±,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,~~~,,,,,,,,,,,,~~~,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,x,,,~~~~~~,,,,,,,,,,~~~~~~,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<~~
,,,,,~~~~~~~~~~,,,,,,,~~~~~~~~~~~~,,,,,,~~~,,,,,,,,,,,,,,,,,,~~~,,,,,,,,~~~~~~~~
,,,~~~~~~~~~~~~~,,,,,~~~~~~~~~~~~~~~,,,~~~~~~~~~~~~~~~~~~,,,~~~~~~~~~,,~~~~~~~~~
,,~~~~~~~~~~~~~~~,,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
""",
        PostRender: b =>
        {
            b.Level.Outdoors = true;
            foreach (var room in b.Level.Rooms)
                room.Flags |= RoomFlags.Lit;
            b.Stair(b['<'], TileType.BranchUp);
            b.Stair(b['>'], TileType.StairsDown);

            var right = b['<'] + Pos.W * 4;
            var left = b['x'];

            HashSet<int> pilesX = [];

            Glyph wreckage = new('≠', ConsoleColor.DarkYellow);
            string[] flotsam = [
                "some flotsam",
                "a broken spar",
                "smashed chests, empty",
                "discarded planks",
                "a rotted figurehead",
                "a tangled net",
                "a barnacle-crusted hull fragment",
                "a snapped mast",
                "waterlogged rope",
                "a shattered lantern",
                "a salt-stained sail",
                "splintered oars",
                "a rusted anchor chain",
                "a cracked ship's wheel",
                "a sodden logbook, illegible",
            ];

            for (int i = 0; i < LevelGen.RnRange(4, 7); i++)
            {
                while (true)
                {
                    int x = LevelGen.RnRange(left.X, right.X);
                    if (pilesX.Contains(x)) continue;
                    int y = left.Y - LevelGen.RnRange(0, 7) + 2;
                    Pos lootPos = new(x, y);
                    if (b.Level[lootPos].Type == TileType.Water) continue;

                    pilesX.Add(x - 1);
                    pilesX.Add(x);
                    pilesX.Add(x + 1);
                    Pos[] n = [..lootPos.Neighbours()];
                    foreach (var p in n.Shuffled().Take(LevelGen.RnRange(2, 4)))
                    {
                        b.Level.GetOrCreateState(p).Feature = new("wreckage", wreckage, flotsam.Pick());
                    }
                    for (int j = 0; j < LevelGen.RnRange(1, 2); j++)
                    {
                        var item = ItemGen.GenerateRandomItem(b.Level.EffectiveDepth + 2);
                        if (item != null)
                            b.Level.PlaceItem(item, lootPos);
                    }
                    break;
                }
            }
        })
    {
        HasPortalToParent = true,
        HasStairsDown = true,
    };
}
